# Task Executor Agent

## Overview

The Task Executor Agent is a Claude Code automation system that monitors GitHub issues with the `ğŸ¤– task-execution` label and executes them automatically using Claude's capabilities.

## Features

- **ğŸš¨ Emergency Response System**: SDECÃ—2SCVÃ—ACR protocol-based emergency task processing
- **Issue Monitoring**: Automatically scans for open issues with the `ğŸ¤– task-execution` label
- **Template Parsing**: Parses structured task definitions from issue bodies
- **Direct Main Branch Merge**: Emergency workflow bypasses PR process for rapid deployment
- **SDECÃ—2SCVÃ—ACR Protocol**: Systematic task validation and execution framework
- **Crash Recovery**: Automatic timeout handling and rollback mechanisms
- **Risk Assessment**: Confidence scoring and safety validation before deployment
- **Progress Tracking**: Real-time issue status updates and error reporting

## File Structure

```
.claude/
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ task-executor.md     # Claude Code Agent definition
â”‚   â””â”€â”€ README.md           # This documentation
â”œâ”€â”€ commands/
â”‚   â””â”€â”€ task-executor.md    # Manual trigger command
â””â”€â”€ workflows/
    â””â”€â”€ task-executor-scheduled.yml  # Automated execution

src/
â”œâ”€â”€ TaskExecutor.ts         # TypeScript issue search and parsing
â”œâ”€â”€ run-task-executor.ts    # Entry point for GitHub Actions
```

## Usage

### Manual Execution

Use the slash command to manually trigger the agent:

```
/task-executor
```

### Automated Execution

The agent runs automatically every 15 minutes via GitHub Actions. You can also trigger it manually from the Actions tab.

## Issue Template

The agent expects issues to follow the `.github/ISSUE_TEMPLATE/task_execution.md` template format:

- **Label**: `ğŸ¤– task-execution`
- **Assignee**: `claude-code`
- **Structured sections**: Context, Goal, Execution Steps, Checklist, Expected Outcomes

### Execution Steps Format

```markdown
### ğŸ”§ **å®Ÿè¡Œæ‰‹é †ï¼ˆå…·ä½“çš„ãªæ‰‹é †ï¼‰**
**Step 1: Preparation**
```bash
npm install
```

**Step 2: Build**
```bash
npm run build
```
```

### Complete Example

```markdown
### ğŸ¯ **ã‚´ãƒ¼ãƒ«ï¼ˆé”æˆåŸºæº–ï¼‰**
Fix TypeScript build errors in src/components/

### ğŸ”§ **å®Ÿè¡Œæ‰‹é †ï¼ˆå…·ä½“çš„ãªæ‰‹é †ï¼‰**
**Step 1: Install Dependencies**
```bash
npm install
```

**Step 2: Build Project**
```bash
npm run build
```

**Step 3: Run Tests**
```bash
npm test
```

### ğŸ” **ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**
- [ ] Build completes without errors
- [ ] All tests pass
- [ ] No TypeScript errors
```

## Execution Process

1. **Issue Detection**: TypeScript code searches for open issues with `ğŸ¤– task-execution` label
2. **Task Validation**: Validates that issues have proper execution steps defined
3. **Claude Delegation**: Creates detailed prompts and delegates to Claude Code Agent
4. **Step Execution**: Claude Code Agent executes commands in sequence
5. **Error Handling**: Stops on first failure and reports error details
6. **PR Creation**: Claude Code Agent creates pull request if all steps succeed
7. **Issue Update**: TypeScript code posts progress comments and closes completed issues

## Architecture

The system uses a hybrid approach:

- **TypeScript Layer** (`src/TaskExecutor.ts`):
  - GitHub API integration for issue searching
  - Task template parsing and validation
  - Progress tracking and error reporting
  - Claude Code delegation

- **Claude Code Agent** (`.claude/agents/task-executor.md`):
  - Actual command execution
  - File modification and testing
  - Pull request creation
  - Step-by-step processing

## Pull Request Automation

When all steps succeed:
1. Creates a new branch: `task-execution-{issue_number}`
2. Commits changes with issue reference
3. Creates a PR with automated description
4. Posts success comment to issue
5. Closes the issue

### PR Template

```markdown
## ğŸ¤– Automated Task Execution

**Related Issue**: #{issue-number}
**Task**: {issue-title}

### Changes Made
- List of modified files

### Verification
- [ ] All execution steps completed
- [ ] Code follows project standards
- [ ] Tests pass
- [ ] Build successful

---
Generated by TaskExecutorAgent
```

## Error Handling

- Failed steps stop execution immediately
- Detailed error comments are added to issues
- Failed executions don't create PRs
- Progress is reported at each step

## Security Considerations

- Uses Claude Code's secure execution environment
- GitHub token has minimal required permissions
- No external API calls except GitHub API
- Command execution follows Claude Code safety guidelines

## Troubleshooting

### Common Issues

1. **No Issues Found**: Check that issues have correct labels and assignee
2. **Parse Errors**: Verify issue template format matches expected structure
3. **Execution Failures**: Review command syntax and dependencies
4. **Permission Errors**: Ensure GitHub token has required permissions

### Debug Mode

Enable verbose logging by checking the GitHub Actions workflow logs or using Claude Code's built-in debugging capabilities.

## Development

### Testing

1. Create test issue with `ğŸ¤– task-execution` label
2. Use `/task-executor` command to manually trigger
3. Monitor execution progress and results
4. Review created PRs for correctness

### Contributing

The agent uses Claude Code's architecture. Changes should be made to:
- Agent definition: `.claude/agents/task-executor.md`
- Command definition: `.claude/commands/task-executor.md`
- Workflow: `.github/workflows/task-executor-scheduled.yml`

## License

This agent is part of the MiyabiPrivate project and follows the same license terms.